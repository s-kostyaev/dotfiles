%% This work may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%   http://www.latex-project.org/lppl.txt
%% and version 1.3 or later is part of all distributions of LaTeX
%% version 2003/12/01 or later.
%% Was created by Sergey Kostyaev aka feofankss (feofankss@mail.ru)


\ProvidesPackage{axiom_tex}[2011/02/06]
\RequirePackage{graphicx}


% axiom (requred empty and axiom_tex-scripts)

\newenvironment{axiomsession}{%
\immediate\write18{axiom_tex-start.sh}}{%
\immediate\write18{axiom_tex-close.sh}}

\newcommand{\axiom}[1]{%
\immediate\write18{axiom_tex-send.sh "#1"}
\immediate\input"result"}


\newcommand{\silentaxiom}[1]{%
\immediate\write18{axiom_tex-send.sh "#1"}}



% gnuplot

\newcommand{\gnuplot}[2]{%
\immediate\write18{echo "set terminal jpeg" > "#1.plot"}
\immediate\write18{echo 'set output "#1.jpg"' >> "#1.plot"}
%\immediate\write18{echo "set encoding utf-8" >> "#1.plot"}
\immediate\write18{echo '#2' >> "#1.plot"}
\immediate\write18{cat #1.plot | axiom_tex-enter.sh | gnuplot -persist}
\begin{figure}[h]
\includegraphics[width=14truecm]{#1.jpg}\label{ris:#1}
\end{figure}}

\newcommand{\plotaxiom}[2]{%
\immediate\write18{axiom_tex-plot.sh #1 "#2"}
\immediate\write18{echo "set terminal postscript 'NimbusSanL-Regu' eps enhanced" > "#1.plot"}
\immediate\write18{echo 'set output "#1.eps"' >> "#1.plot"}
%\immediate\write18{echo "set encoding utf-8" >> "#1.plot"}
\immediate\write18{cat "#1.dat" >> "#1.plot"}
\immediate\write18{gnuplot -persist "#1.plot"}
\begin{figure}[h]
\includegraphics{#1}\label{ris:#1}
\end{figure}}

\newcommand{\doubleplotaxiom}[3]{%
\immediate\write18{axiom_tex-plot.sh #1.1 "#2"}
\immediate\write18{axiom_tex-plot.sh #1.2 "#3"}
\immediate\write18{echo "set terminal postscript 'NimbusSanL-Regu' eps enhanced" > "#1.plot"}
\immediate\write18{echo 'set output "#1.eps"' >> "#1.plot"}
%\immediate\write18{echo "set encoding utf-8" >> "#1.plot"}
\immediate\write18{cat "#1.1.dat" >> "#1.plot"}
\immediate\write18{cat "#1.2.dat" | grep -v title >> "#1.plot"}
\immediate\write18{gnuplot -persist "#1.plot"}
\begin{figure}[h]
\includegraphics{#1}\label{ris:#1}
\end{figure}}

\newcommand{\tripleplotaxiom}[4]{%
\immediate\write18{axiom_tex-plot.sh #1.1 "#2"}
\immediate\write18{axiom_tex-plot.sh #1.2 "#3"}
\immediate\write18{axiom_tex-plot.sh #1.3 "#4"}
\immediate\write18{echo "set terminal postscript 'NimbusSanL-Regu' eps enhanced" > "#1.plot"}
\immediate\write18{echo 'set output "#1.eps"' >> "#1.plot"}
%\immediate\write18{echo "set encoding utf-8" >> "#1.plot"}
\immediate\write18{cat "#1.1.dat" >> "#1.plot"}
\immediate\write18{cat "#1.2.dat" | grep -v title >> "#1.plot"}
\immediate\write18{cat "#1.3.dat" | grep -v title >> "#1.plot"}
\immediate\write18{gnuplot -persist "#1.plot"}
\begin{figure}[h]
\includegraphics{#1}\label{ris:#1}
\end{figure}}


